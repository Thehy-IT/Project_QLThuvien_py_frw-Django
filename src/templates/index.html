{% extends 'library/base.html' %} {# Kế thừa từ base.html để có cùng header và footer #}
{% load static %} {# Tải template tag để quản lý các tệp tĩnh như CSS, JS #}

{% block title %}Thư Viện Sách-Kí Ức Số{% endblock %} {# Đặt tiêu đề riêng cho trang này, xuất hiện trên tab trình duyệt #}

{% block content %} {# Khối nội dung chính của trang #}
<div class="flex items-center justify-center min-h-[calc(100vh-160px)]"> {# Sử dụng flexbox để căn giữa nội dung theo chiều dọc và ngang, min-h để chiếm phần lớn chiều cao màn hình #}
    <div class="bg-white p-8 rounded-lg shadow-xl text-center max-w-5xl w-full"> {# Tạo một khung chứa nội dung với nền trắng, padding, bo tròn góc, đổ bóng và giới hạn chiều rộng #}
        <h2 class="text-4xl font-bold text-gray-800 mb-8">Welcome to the Booktok Library</h2> {# Tiêu đề chính của trang chủ, font lớn, đậm, màu xám đậm #}
        <p class="text-lg text-gray-600 mb-8"> {# Đoạn văn giới thiệu hệ thống #}
            Quản lý sách, thành viên và các giao dịch mượn/trả sách một cách hiệu quả.
            Đây là nền tảng giúp bạn theo dõi tài nguyên thư viện của mình một cách dễ dàng.
        </p>

        {# Summary Statistics Section - Phần thống kê tổng kết #}
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mb-10"> {# Sử dụng CSS Grid để tạo layout đáp ứng cho các thẻ thống kê #}
            {# Thẻ hiển thị Tổng số Sách #}
            <div class="bg-blue-100 p-5 rounded-lg shadow-md flex flex-col items-center justify-center"> {# Nền xanh nhạt, padding, bo tròn, đổ bóng, căn giữa nội dung #}
                <i class="fas fa-book text-4xl text-blue-600 mb-3"></i> {# Icon sách từ Font Awesome, kích thước lớn, màu xanh #}
                <h3 class="text-xl font-semibold text-gray-700">Tổng số Sách</h3> {# Tiêu đề nhỏ hơn cho số liệu #}
                <p class="text-3xl font-bold text-blue-800 mt-2">{{ total_books }}</p> {# Hiển thị số liệu tổng số sách, lấy từ context của Django view #}
            </div>
            
            {# Thẻ hiển thị Sách đang Mượn #}
            <div class="bg-green-100 p-5 rounded-lg shadow-md flex flex-col items-center justify-center">
                <i class="fas fa-hand-holding-usd text-4xl text-green-600 mb-3"></i> {# Icon mượn trả, màu xanh lá cây #}
                <h3 class="text-xl font-semibold text-gray-700">Sách đang Mượn</h3>
                <p class="text-3xl font-bold text-green-800 mt-2">{{ borrowed_books }}</p> {# Hiển thị số sách đã mượn #}
            </div>

            {# Thẻ hiển thị Sách còn lại #}
            <div class="bg-yellow-100 p-5 rounded-lg shadow-md flex flex-col items-center justify-center">
                <i class="fas fa-book-open text-4xl text-yellow-600 mb-3"></i> {# Icon sách mở, màu vàng #}
                <h3 class="text-xl font-semibold text-gray-700">Sách còn lại</h3>
                <p class="text-3xl font-bold text-yellow-800 mt-2">{{ available_books }}</p> {# Hiển thị số sách còn lại, cần được tính trong view #}
            </div>

            {# Thẻ hiển thị Tổng số Thành viên #}
            <div class="bg-purple-100 p-5 rounded-lg shadow-md flex flex-col items-center justify-center">
                <i class="fas fa-users text-4xl text-purple-600 mb-3"></i> {# Icon người dùng, màu tím #}
                <h3 class="text-xl font-semibold text-gray-700">Tổng số Thành viên</h3>
                <p class="text-3xl font-bold text-purple-800 mt-2">{{ total_members }}</p> {# Hiển thị tổng số thành viên #}
            </div>
            
            {# Thẻ hiển thị Sách quá hạn #}
            <div class="bg-red-100 p-5 rounded-lg shadow-md flex flex-col items-center justify-center">
                <i class="fas fa-exclamation-triangle text-4xl text-red-600 mb-3"></i> {# Icon cảnh báo, màu đỏ #}
                <h3 class="text-xl font-semibold text-gray-700">Sách quá hạn</h3>
                <p class="text-3xl font-bold text-red-800 mt-2">{{ overdue_books_count }}</p> {# Hiển thị số sách quá hạn #}
            </div>
        </div>

        {# Chart Section - Phần biểu đồ thống kê #}
        <div class="mt-12 bg-gray-50 p-6 rounded-lg shadow-inner">
            <h3 class="text-2xl font-bold text-gray-800 mb-6 text-center">Biểu đồ Tổng quan Thư viện</h3>
            <div class="relative h-96 w-full mx-auto">
                <canvas id="libraryStatsChart"></canvas>
            </div>
        </div>

        <p class="text-md text-gray-500 mt-8"> {# Đoạn văn kết thúc #}
            Bắt đầu khám phá các tính năng của hệ thống ngay bây giờ!
        </p>
    </div>
</div>

{# Tải thư viện Chart.js để vẽ biểu đồ #}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

{# Script để khởi tạo và cấu hình biểu đồ #}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const ctx = document.getElementById('libraryStatsChart').getContext('2d');
        
        new Chart(ctx, {
            type: 'bar', // Loại biểu đồ là cột
            data: {
                labels: [
                    'Tổng số Sách',
                    'Sách đang Mượn',
                    'Sách còn lại',
                    'Tổng số Thành viên',
                    'Sách quá hạn'
                ],
                datasets: [{
                    label: 'Số lượng',
                    data: [
                        {{ total_books|default:0 }},
                        {{ borrowed_books|default:0 }},
                        {{ available_books|default:0 }},
                        {{ total_members|default:0 }},
                        {{ overdue_books_count|default:0 }}
                    ],
                    backgroundColor: [
                        'rgba(54, 162, 235, 0.6)',  // Blue
                        'rgba(75, 192, 192, 0.6)',  // Green
                        'rgba(255, 206, 86, 0.6)',  // Yellow
                        'rgba(153, 102, 255, 0.6)', // Purple
                        'rgba(255, 99, 132, 0.6)'   // Red
                    ],
                    borderColor: 'rgba(0, 0, 0, 0.1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            // Đảm bảo các tick là số nguyên nếu dữ liệu nhỏ
                            precision: 0
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false // Ẩn chú thích vì đã có nhãn trên các cột
                    },
                    title: {
                        display: false // Tiêu đề đã được thêm bằng thẻ H3 ở trên
                    }
                }
            }
        });
    });
</script>
{% endblock content %}